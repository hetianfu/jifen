(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-726779cc"],{"948f":function(t,e,a){},bd94:function(t,e,a){"use strict";a("948f")},c156:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-card",[a("a-form",[a("div",{staticClass:"margin-bottom-16"},[a("a-row",{attrs:{gutter:8}},[a("a-col",{attrs:{md:2,sm:24}},[a("a-select",{staticClass:"width-percent-100",attrs:{allowClear:"",placeholder:"是否生效"},model:{value:t.queryParam.status,callback:function(e){t.$set(t.queryParam,"status",e)},expression:"queryParam.status"}},t._l(t.COUPON_TEMPLATE_STATUS,(function(e,i){return a("a-select-option",{key:i,attrs:{value:e.value}},[t._v(t._s(e.name))])})),1)],1),a("a-col",{attrs:{md:2,sm:24}},[a("a-select",{staticClass:"width-percent-100",attrs:{allowClear:"",placeholder:"类型"},model:{value:t.queryParam.type,callback:function(e){t.$set(t.queryParam,"type",e)},expression:"queryParam.type"}},t._l(t.tempType,(function(e,i){return a("a-select-option",{key:i,attrs:{value:e.value}},[t._v(t._s(e.name))])})),1)],1),a("a-col",{attrs:{md:4,sm:24}},[a("a-input",{attrs:{allowClear:"",placeholder:"模板名称"},model:{value:t.queryParam.title,callback:function(e){t.$set(t.queryParam,"title",e)},expression:"queryParam.title"}})],1),a("a-col",{attrs:{md:4,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.$refs.table.refresh(!0)}}},[t._v("查询")]),a("a-button",{staticClass:"margin-left-8",on:{click:function(){return t.queryParam={}}}},[t._v("重置")])],1)])],1)],1)]),a("a-button",{staticClass:"margin-bottom-8",attrs:{type:"primary"},on:{click:t.handleAdd}},[a("a-icon",{attrs:{type:"plus"}}),t._v("添加优惠券模板")],1),a("s-table",{ref:"table",attrs:{rowKey:function(t,e){return e},columns:t.columns,data:t.loadData,pagination:t.pagination},scopedSlots:t._u([{key:"amount",fn:function(e){return[t._v(" "+t._s(t._f("moneyFormat")(e))+" ")]}},{key:"limitAmount",fn:function(e){return[t._v(" "+t._s(t._f("moneyFormat")(e))+" ")]}},{key:"effectDays",fn:function(e){return[t._v(" "+t._s(e)+" 天 ")]}},{key:"status",fn:function(e,i){return t._l(t.COUPON_TEMPLATE_STATUS,(function(e){return i.status===e.value?a("a-badge",{key:e.value,attrs:{text:e.name,status:1===e.value?"processing":"error"}}):t._e()}))}},{key:"type",fn:function(e,i){return t._l(t.tempType,(function(e){return i.type===e.value?a("a-tag",{key:e.value,attrs:{color:e.color}},[t._v(t._s(e.name))]):t._e()}))}},{key:"showOrder",fn:function(e,i){return[a("edit-name",{attrs:{text:String(i.showOrder),scope:i},on:{change:function(e){return t.onEditChange(i.id,"showOrder",e)}}})]}},{key:"action",fn:function(e,i){return[a("a-dropdown",{attrs:{trigger:["click"]}},[a("a",[t._v("操作 "),a("a-icon",{attrs:{type:"down"}})],1),a("a-menu",{staticStyle:{width:"100px","text-align":"center"},attrs:{slot:"overlay"},slot:"overlay"},[1===i.status?a("a-menu-item",{on:{click:function(e){return t.handlePublish(i)}}},[a("a",[t._v("发布")])]):t._e(),a("a-menu-item",{on:{click:function(e){return t.handleEdit(i)}}},[a("a",[t._v("编辑")])]),a("a-menu-item",{on:{click:function(e){return t.handleDel(i)}}},[a("a",{staticClass:"color-red"},[t._v("删除")])])],1)],1)]}}])})],1),a("a-modal",{attrs:{title:t.coupon.title,width:"700px"},on:{cancel:t.cancelHandle,ok:function(e){"add"===t.coupon.status?t.handleCouponAdd():t.handleCouponEdit()}},model:{value:t.coupon.visible,callback:function(e){t.$set(t.coupon,"visible",e)},expression:"coupon.visible"}},[a("a-tabs",{on:{change:t.changeType},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.tempType,(function(e){return a("a-tab-pane",{key:e.value,attrs:{tab:e.name,disabled:e.status}},[a("a-form",{attrs:{form:t.coupon.form,"label-col":{span:5},"wrapper-col":{span:18}}},["edit"===t.coupon.status?a("a-form-item",{staticClass:"display-none",attrs:{label:"ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id"],expression:"['id']"}]})],1):t._e(),a("a-form-item",{attrs:{label:"模板名称"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"模板名称不能为空!"}]}],expression:"['title', { rules: [{ required: true, message: '模板名称不能为空!' }] }]"}],attrs:{placeholder:"请输入模板名称"}})],1),"CATEGORY"===t.type?a("a-form-item",{attrs:{label:"优惠券品类"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["typeRelationId",{rules:[{required:!0,message:"请选择分类"}]}],expression:"['typeRelationId', {rules: [{ required: true, message: '请选择分类'}]}]"}],staticClass:"width-percent-100",attrs:{placeholder:"请选择分类",mode:"multiple"}},t._l(t.categoryTree,(function(e,i){return a("a-select-opt-group",{key:i},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v(t._s(e.name))]),t._l(e.children,(function(e,i){return a("a-select-option",{key:i,attrs:{value:e.id}},[t._v(" "+t._s(e.name)+" ")])}))],2)})),1)],1):t._e(),"PRODUCT"===t.type?a("a-form-item",{attrs:{label:"商品："}},[a("div",{on:{click:t.productAdd}},[t._l(t.productList,(function(t,e){return a("img",{key:e,staticClass:"product-img",attrs:{src:t.images[0]}})})),a("a-button",{attrs:{size:"small"}},[t._v("+添加商品")])],2)]):t._e(),a("a-form-item",{attrs:{label:"优惠券面值："}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["amount",{rules:[{required:!0,message:"请输入优惠券面值"}]}],expression:"['amount', { rules: [{ required: true, message: '请输入优惠券面值' }] }]"}],staticClass:"width-percent-50",attrs:{min:0,placeholder:"请输入优惠券面值"}})],1),a("a-form-item",{attrs:{label:"最低消费："}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["limitAmount",{rules:[{required:!0,message:"请输入最低消费"}]}],expression:"['limitAmount', { rules: [{ required: true, message: '请输入最低消费' }] }]"}],staticClass:"width-percent-50",attrs:{min:0,placeholder:"请输入最低消费"}})],1),a("a-form-item",{attrs:{label:"有效期限："}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["effectDays",{rules:[{required:!0,message:"请输入有效期限"}]}],expression:"['effectDays', { rules: [{ required: true, message: '请输入有效期限' }] }]"}],staticClass:"width-percent-50",attrs:{min:0,placeholder:"请输入有效期限（天）"}})],1),a("a-form-item",{attrs:{label:"排序："}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["showOrder",{initialValue:0}],expression:"['showOrder', { initialValue: 0 }]"}],attrs:{min:0}})],1),a("a-form-item",{attrs:{label:"状态"}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{initialValue:1}],expression:"['status', { initialValue: 1 }]"}]},[a("a-radio",{attrs:{value:1}},[t._v("生效")]),a("a-radio",{attrs:{value:0}},[t._v("失效")])],1)],1)],1)],1)})),1)],1),a("product-list",{attrs:{productList:t.productList},on:{submit:t.productSubmit},model:{value:t.product.visible,callback:function(e){t.$set(t.product,"visible",e)},expression:"product.visible"}}),a("a-modal",{attrs:{title:t.publish.title,width:"800px"},on:{ok:t.publishSubmit},model:{value:t.publish.visible,callback:function(e){t.$set(t.publish,"visible",e)},expression:"publish.visible"}},[a("div",{staticClass:"pubMalClass"},[a("a-form",{attrs:{form:t.publish.form,"label-col":{span:5},"wrapper-col":{span:12}}},[a("a-form-item",{staticClass:"display-none",attrs:{label:"优惠券ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["templateId",{rules:[{required:!0}]}],expression:"['templateId', { rules: [{ required: true }] }]"}],attrs:{disabled:""}})],1),a("a-form-item",{attrs:{label:"是否限时领取"}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["isPermanent",{initialValue:0}],expression:"['isPermanent', {initialValue: 0}]"}],on:{change:t.changeTime}},[a("a-radio",{attrs:{value:0}},[t._v("限时")]),a("a-radio",{attrs:{value:1}},[t._v("不限时")])],1)],1),t.publish.time?t._e():a("a-form-item",{attrs:{label:"领取时间"}},[a("a-range-picker",{on:{change:t.publishTimeChange}})],1),a("a-form-item",{attrs:{label:"发布数量"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["limitNumber",{initialValue:1}],expression:"['limitNumber', {initialValue: 1}]"}],attrs:{min:1,max:1e5}})],1),a("a-form-item",{attrs:{label:"手动领取"}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["isOnce",{initialValue:1}],expression:"['isOnce', {initialValue: 1}]"}],on:{change:t.handleIsOnce}},[a("a-radio",{attrs:{value:1}},[t._v("是")]),a("a-radio",{attrs:{value:0}},[t._v("否")])],1)],1)],1)],1)])],1)},s=[],n=(a("a15b"),a("d81d"),a("d3b7"),a("ac1f"),a("1276"),a("5530")),o=a("ade3"),r=a("2af9"),l=a("2ef0"),c=a("4c79"),u=a("ed08"),d=a("66da"),m=a("4124"),p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"editable-cell"},[t.editable?a("div",{staticClass:"editable-cell-input-wrapper"},[a("a-input",{staticClass:"input-class",attrs:{value:t.value},on:{change:t.handleChange,pressEnter:t.check}}),a("a-icon",{staticClass:"editable-cell-icon-check",attrs:{type:"check"},on:{click:t.check}})],1):a("div",{staticClass:"editable-cell-text-wrapper input-class"},[a("a-popover",{attrs:{placement:"topLeft",arrowPointAtCenter:""}},[a("template",{slot:"content"},[t._v(t._s(t.value))]),a("span",[t._v(t._s(t._f("textOverflowEllipsis")(t.value,0,10)))])],2),a("a-icon",{staticClass:"editable-cell-icon",attrs:{type:"edit"},on:{click:t.edit}})],1)])},h=[],f={props:{text:{type:String,required:!0},scope:{type:Object,required:!0}},data:function(){return{value:this.text,row:this.scope,editable:!1}},watch:{text:function(t){this.value=t},scope:function(t){this.row=t}},methods:{handleChange:function(t){var e=t.target.value;this.value=e},check:function(){this.editable=!1,this.$emit("change",this.value)},edit:function(){this.editable=!0}}},v=f,b=(a("bd94"),a("2877")),y=Object(b["a"])(v,p,h,!1,null,"14017354",null),g=y.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"选择商品",width:"1200px"},on:{ok:t.submitProduct,cancel:t.cancelHandle},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("a-row",{staticClass:"margin-bottom-16",attrs:{gutter:5}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-input",{attrs:{placeholder:"商品名称",allowClear:""},model:{value:t.queryParam.name,callback:function(e){t.$set(t.queryParam,"name",e)},expression:"queryParam.name"}})],1),a("a-col",{attrs:{md:4,sm:24}},[a("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"是否上架",allowClear:""},model:{value:t.queryParam.isOnSale,callback:function(e){t.$set(t.queryParam,"isOnSale",e)},expression:"queryParam.isOnSale"}},[a("a-select-option",{attrs:{value:1}},[t._v("上架")]),a("a-select-option",{attrs:{value:0}},[t._v("下架")])],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(e){return t.$refs.table.refresh(!0)}}},[t._v("查询")]),a("a-button",{staticClass:"margin-left-8",on:{click:function(){return t.queryParam={}}}},[t._v("重置")])],1)])],1),a("s-table",{ref:"tab",attrs:{rowKey:function(t){return t.id},columns:t.columns,data:t.loadData,rowSelection:{columnWidth:100,selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},pagination:t.pagination,scroll:{y:440}},scopedSlots:t._u([{key:"isOnSale",fn:function(e,a){return[t._v(" "+t._s(1===a.isOnSale?"上架":"已下架")+" ")]}}])})],1)},O=[],_=(a("b0c0"),{components:{STable:r["p"]},props:{value:{type:Boolean},productList:{type:Array}},watch:{value:function(t){this.visible=t;var e={};this.selectedRowKeys=this.productList.map((function(t){return e[t.id]=t,t.id})),this.selectedRows=e}},model:{prop:"value",event:"change"},data:function(){var t=this;return{queryParam:{},pagination:{pageSize:10,current:1},list:[],visible:!1,columns:[{title:"商品名称",dataIndex:"name",scopedSlots:{customRender:"name"},width:"25%"},{title:"原价",dataIndex:"originPrice",scopedSlots:{customRender:"originPrice"},width:"15%"},{title:"售价",dataIndex:"salePrice",scopedSlots:{customRender:"salePrice"},width:"10%"},{title:"会员价",dataIndex:"memberPrice",scopedSlots:{customRender:"memberPrice"},width:"10%"},{title:"成本价",dataIndex:"costPrice",scopedSlots:{customRender:"costPrice"},width:"10%"},{title:"库存",dataIndex:"isStock",scopedSlots:{customRender:"isStock"},width:"10%"},{title:"上下架",dataIndex:"isOnSale",scopedSlots:{customRender:"isOnSale"},width:"10%"},{title:"已售数量",dataIndex:"baseSalesNumber",scopedSlots:{customRender:"baseSalesNumber"},width:"10%"}],loadData:function(e){var a=e.pageNo,i=e.pageSize,s=t.queryParam,n=s.name,o=s.isOnSale,r={page:a,limit:i,name:n,isOnSale:o,saleStrategy:"NORMAL"};return Object(c["k"])(r).then((function(e){var s=e.data,n=s.list,o=s.totalCount;return t.list=n,{pageNo:a,pageSize:i,data:n,totalCount:o}}))},data:[],selectedRows:[],selectedRowKeys:[]}},created:function(){},methods:{onSelectChange:function(t,e){var a=this;e.map((function(t,e){a.selectedRows[t.id]=t})),this.selectedRowKeys=t},submitProduct:function(){var t=this.selectedRows,e=this.selectedRowKeys,a=e.map((function(e){return t[e]}));this.$emit("change",!1),this.$emit("submit",this.selectedRowKeys,a)},cancelHandle:function(){this.$emit("change",!1),this.$emit("submit",this.selectedRowKeys,this.productList)}}}),C=_,P=Object(b["a"])(C,w,O,!1,null,null,null),k=P.exports,S=a("f121"),R={components:{STable:r["p"],EditName:g,ProductList:k},data:function(){var t=this;return{queryParam:{},COUPON_TEMPLATE_STATUS:S["d"],COUPON_TEMPLATE_TYPE:S["e"],tempType:Object(l["cloneDeep"])(S["e"]),pagination:{pageSize:10,current:1},type:"COMMON",categoryTree:[],productList:[],coupon:{title:"",status:"",visible:!1,form:null},product:{title:"",visible:!1,form:null},publish:{visible:!1,time:!1,isOnce:!0,fromtime:"",totime:""},columns:[{title:"订单号",dataIndex:"id",scopedSlots:{customRender:"id"}},{title:"模板名称",dataIndex:"title",scopedSlots:{customRender:"title"}},{title:"类型",key:"type",scopedSlots:{customRender:"type"}},{title:"优惠券面值",dataIndex:"amount",scopedSlots:{customRender:"amount"}},{title:"最低消费",dataIndex:"limitAmount",scopedSlots:{customRender:"limitAmount"}},{title:"是否有效",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"有效期限",dataIndex:"effectDays",scopedSlots:{customRender:"effectDays"}},{title:"排序",scopedSlots:{customRender:"showOrder"},sorter:!0},{title:"操作",scopedSlots:{customRender:"action"}}],loadData:function(e){var a=e.pageNo,i=e.pageSize,s=e.sortOrder,n=void 0===s?"ascend":s,o=t.queryParam,r=o.title,l=o.status,c=o.type,u={page:a,limit:i,title:r||void 0,status:l,type:c||void 0,orders:{show_order:"ascend"===n?"asc":"desc"}};return Object(m["n"])(u).then((function(t){var e=t.data,s=e.list,n=e.totalCount;return{pageNo:a,pageSize:i,data:s,totalCount:n}}))}}},created:function(){},methods:{setInfo:function(t,e){t=Object.assign(t,e)},getCategoryList:function(){var t=this;Object(d["e"])().then((function(e){t.categoryTree=Object(u["u"])(e.data)}))},onEditChange:function(t,e,a){var i=this;void 0===a&&(a=null),Object(m["t"])(Object(o["a"])({id:t},e,a)).then((function(t){i.$message.success("修改成功")}))},handleAdd:function(){this.type="COMMON",this.setInfo(this.coupon,{status:"add",visible:!0,title:"添加模板",form:this.$form.createForm(this)}),this.tempType=this.COUPON_TEMPLATE_TYPE},changeType:function(t){this.type=t,this.setInfo(this.coupon,{form:this.$form.createForm(this)}),"CATEGORY"===this.type?this.getCategoryList():"PRODUCT"===this.type&&(this.productList=[])},handleCouponAdd:function(){var t=this,e=this.$refs.table,a=this.$notification.success,i=this.type;this.coupon.form.validateFields((function(s,o){if(!s){"CATEGORY"===i?o.typeRelationId=o.typeRelationId.join(","):"PRODUCT"===i&&(o.typeRelationId=t.productList.map((function(t){return t.id})).join(","));var r=Object(n["a"])(Object(n["a"])({},o),{},{type:i});Object(m["b"])(r).then((function(i){a({message:"成功",description:"添加成功"}),e.refresh(),t.setInfo(t.coupon,{visible:!1})}))}}))},handleEdit:function(t){var e=this;this.type=t.type,"CATEGORY"===t.type?this.getCategoryList():"PRODUCT"===t.type&&Object(c["k"])({id:t.typeRelationId}).then((function(t){e.productList=t.data.list}));var a=Object(l["cloneDeep"])(this.COUPON_TEMPLATE_TYPE);a.map((function(e){e.value===t.type?e.status=!1:e.status=!0})),this.tempType=a,new Promise((function(t){setTimeout(t,0)})).then((function(){t.typeRelationId&&(t.typeRelationId=t.typeRelationId.split(",")),"PRODUCT"===e.type?e.coupon.form.setFieldsValue(Object(l["pick"])(t,["id","title","amount","limitAmount","effectDays","showOrder","status"])):e.coupon.form.setFieldsValue(Object(l["pick"])(t,["id","title","amount","typeRelationId","limitAmount","effectDays","showOrder","status"]))})),this.setInfo(this.coupon,{status:"edit",visible:!0,title:"编辑 [ ".concat(t.title," ] "),form:this.$form.createForm(this)})},handleCouponEdit:function(){var t=this,e=this.$refs.table,a=this.$notification.success,i=this.coupon,s=this.type;i.form.validateFields((function(o,r){if(!o){"CATEGORY"===s?r.typeRelationId=r.typeRelationId.join(","):"PRODUCT"===s&&(r.typeRelationId=t.productList.map((function(t){return t.id})).join(","));var l=Object(n["a"])(Object(n["a"])({},r),{},{type:s});Object(m["t"])(l).then((function(t){a({message:"成功",description:"修改成功"}),e.refresh(),i.visible=!1}))}}))},productAdd:function(){this.product.visible=!0},productSubmit:function(t,e){this.productList=e},cancelHandle:function(){this.$refs.table.refresh()},handleDel:function(t){var e=this.$refs.table,a=this.$notification.success;this.$confirm({title:"警告",content:"是否删除[ ".concat(t.title," ]"),onOk:function(){Object(m["e"])(t.id).then((function(t){a({message:"成功",description:"删除成功"}),e.refresh(!0)}))}})},changeTime:function(t){this.publish.time=Boolean(t.target.value),this.publish.time&&(this.publish.fromtime=void 0,this.publish.totime=void 0)},handleIsOnce:function(t){this.publish.isOnce=Boolean(t.target.value)},publishTimeChange:function(t,e){this.publish.fromtime=e[0],this.publish.totime=e[1]},handlePublish:function(t){var e=this;this.setInfo(this.publish,{visible:!0,title:"发布[ ".concat(t.title," ] "),form:this.$form.createForm(this),status:"publish"}),new Promise((function(t){setTimeout(t,0)})).then((function(){t.templateId=t.id,e.publish.form.setFieldsValue(Object(l["pick"])(t,["templateId"]))}))},publishSubmit:function(){var t=this,e=this.publish,a=e.form,i=e.totime,s=e.fromtime,o=e.templateId;a.validateFields((function(e,a){var r=Object(n["a"])(Object(n["a"])({templateId:o},a),{},{totime:i||void 0,fromtime:s||void 0});e||Object(m["o"])(r).then((function(e){t.$notification.success({message:"成功",description:"发布成功"}),t.publish.visible=!1}))}))}}},x=R,T=(a("c600"),Object(b["a"])(x,i,s,!1,null,"0f596e66",null));e["default"]=T.exports},c600:function(t,e,a){"use strict";a("ea141")},ea141:function(t,e,a){}}]);