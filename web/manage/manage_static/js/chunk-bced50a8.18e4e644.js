(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bced50a8"],{"1bd7":function(t,e,a){"use strict";a("52c0")},"42ce":function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"c",(function(){return s})),a.d(e,"b",(function(){return c}));var n=a("365c"),r=a("b775"),o=n["b"].refund;function i(t){return Object(r["b"])({url:o.refundGetPage,method:"get",params:t})}function s(t){return Object(r["b"])({url:o.updateForbid+t.id,method:"patch",data:t})}function c(t){return Object(r["b"])({url:o.updateApprove+t.id,method:"patch",data:t})}},"52c0":function(t,e,a){},fda3:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-view",{attrs:{title:"用户申请退单列表"}},[a("div",[a("a-card",[a("a-row",{staticClass:"margin-bottom-24"},[a("a-col",{attrs:{span:2}},[t._v("创建时间:")]),a("a-col",{staticClass:"col-class",attrs:{span:22}},[t._l(t.ORDER_INFO_QUERY_DAY,(function(e,n){return a("a-checkable-tag",{key:n,staticClass:"checkable-tag-class",on:{change:function(a){return t.onChangeQueryDay(e,n)}},model:{value:e.isSelected,callback:function(a){t.$set(e,"isSelected",a)},expression:"item.isSelected"}},[t._v(" "+t._s(e.name)+" ")])})),a("a-checkable-tag",{staticClass:"checkable-tag-class",on:{change:t.onChangeTime}},[t._v("自定义")]),t.rangeStu?a("a-range-picker",{staticStyle:{width:"210px"},on:{change:t.onChangeCreateTime},model:{value:t.queryParam.timeRange,callback:function(e){t.$set(t.queryParam,"timeRange",e)},expression:"queryParam.timeRange"}}):t._e()],2)],1),a("a-row",{staticClass:"margin-bottom-16",attrs:{gutter:10}},[a("a-col",{attrs:{span:4}},[a("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"类型",allowClear:""},model:{value:t.queryParam.status,callback:function(e){t.$set(t.queryParam,"status",e)},expression:"queryParam.status"}},t._l(t.typeList,(function(e){return a("a-select-option",{key:e.value},[t._v(t._s(e.name))])})),1)],1),a("a-col",{attrs:{span:8}},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.$refs.table.refresh(!0)}}},[t._v("查询")]),a("a-button",{staticClass:"margin-left-10",on:{click:function(){return t.queryParam={}}}},[t._v("重置")])],1)],1),a("s-table",{ref:"table",attrs:{rowKey:function(t,e){return e},columns:t.columns,data:t.loadData,pagination:t.pagination},scopedSlots:t._u([{key:"userSnap",fn:function(e){return[e?a("div",{staticClass:"user-info display-flex align-items-center"},[a("div",{staticClass:"user-head-img cursor-pointer"},[a("a-avatar",e?{staticClass:"margin-right-16",attrs:{size:32,src:e.headImg}}:{staticClass:"margin-right-16",attrs:{size:32,icon:"user"}})],1),a("div",{staticClass:"user-nick-name display-flex flex-direction-column cursor-pointer"},[a("a-popover",{attrs:{placement:"topLeft"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.nickName))]),a("span",[t._v(t._s(t._f("textOverflowEllipsis")(e.nickName,0,4)))])])],1)]):t._e()]}},{key:"orderAmount",fn:function(e){return[t._v(t._s(t._f("moneyFormat")(e)))]}},{key:"refundAmount",fn:function(e){return[t._v(t._s(t._f("moneyFormat")(e)))]}},{key:"originStatus",fn:function(e,n){return t._l(t.ORDER_INFO_STATUS,(function(e,r){return a("div",{key:r},[n.originStatus===e.value?a("span",[t._v(t._s(e.name))]):t._e()])}))}},{key:"createdAt",fn:function(e,a){return[t._v(" "+t._s(t._f("parseTime")(a.createdAt))+" ")]}},{key:"status",fn:function(e){return t._l(t.typeList,(function(n,r){return e===n.value?a("a-tag",{key:r,attrs:{color:n.color}},[t._v(t._s(n.name))]):t._e()}))}},{key:"failMsg",fn:function(e,n){return[a("a-popover",{attrs:{placement:"topLeft"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.failMsg))]),a("span",[t._v(t._s(t._f("textOverflowEllipsis")(n.failMsg,0,8)))])])]}},{key:"content",fn:function(t){return[a("s-table-text",{attrs:{text:t}})]}},{key:"action",fn:function(e,n){return[a("a-dropdown",{attrs:{trigger:["click"]}},[a("a",{staticClass:"ant-dropdown-link"},[t._v("操作 "),a("a-icon",{attrs:{type:"down"}})],1),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",{on:{click:function(e){return t.getHandleInfo(n)}}},[a("a",[t._v("订单详情")])]),0===n.status?a("a-menu-item",{on:{click:function(e){return t.onChangeForbid(n)}}},[a("a",[t._v("禁止退款")])]):t._e(),0===n.status?a("a-menu-item",{on:{click:function(e){return t.onChangeApprove(n)}}},[a("a",[t._v("同意退款")])]):t._e()],1)],1)]}}])})],1),a("a-modal",{attrs:{title:t.chargeBack.title},on:{ok:function(e){"yes"===t.chargeBack.status?t.getHandleApprove():t.getHandleForbid()}},model:{value:t.chargeBack.visible,callback:function(e){t.$set(t.chargeBack,"visible",e)},expression:"chargeBack.visible"}},[a("a-form",{attrs:{form:t.chargeBack.form,"label-col":{span:5},"wrapper-col":{span:18}}},[a("a-form-item",{attrs:{label:"订单ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id"],expression:"['id']"}],attrs:{disabled:""}})],1),a("a-form-item",{attrs:{label:"原始状态"}},[a("span",{staticClass:"margin-right-16"},[t._v(t._s(t.originText))]),a("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["checkbox"],expression:"['checkbox']"}]},[t._v("保持订单原状态")])],1),a("a-form-item",{attrs:{label:"订单金额"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["orderAmount"],expression:"['orderAmount']"}],attrs:{disabled:""}})],1),"yes"===t.chargeBack.status?a("a-form-item",{attrs:{label:"退款金额",help:"注：退款金额不能大于订单金额"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["refundAmount"],expression:"['refundAmount']"}],attrs:{min:0,max:t.chargeBack.orderAmount,placeholder:"0.00"}})],1):t._e(),a("a-form-item",{attrs:{label:"no"===t.chargeBack.status?"禁止退款原因":"备注"}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["failMsg",{rules:[{required:"no"===t.chargeBack.status,message:"请输入禁止退款原因"}]}],expression:"['failMsg', { rules: [{ required: chargeBack.status==='no'?true:false, message: '请输入禁止退款原因' }] }]"}],attrs:{placeholder:"no"===t.chargeBack.status?"请填写禁止退款原因":"备注"}})],1)],1)],1)],1),t.infoShow?a("order-info",{attrs:{show:t.infoShow,info:t.orderRow},on:{cancel:t.cancelInfo}}):t._e()],1)},r=[],o=(a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("2ef0")),i=a("680a"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"s-table-text"},[a("a-popover",{attrs:{placement:"topLeft",arrowPointAtCenter:"",overlayStyle:t.textStyle}},[a("template",{slot:"content"},[t._v(t._s(t.text))]),a("span",[t._v(t._s(t._f("textOverflowEllipsis")(t.text,0,8)))])],2)],1)},c=[],u={props:{text:{required:!0}},watch:{text:function(t){this.text=t}},data:function(){return{textStyle:{"max-width":"400px"}}}},l=u,d=a("2877"),f=Object(d["a"])(l,s,c,!1,null,"6059c087",null),m=f.exports,g=a("42ce"),p=a("365c"),h=a("b775"),v=p["b"].queryTime;function _(t){return Object(h["b"])({url:v.getQueryDay,method:"get",params:t})}var b=a("f121"),k=a("2af9"),S=a("2f38"),y={components:{PageView:i["c"],STable:k["p"],STableText:m,OrderInfo:k["m"]},data:function(){var t=this;return{orderRow:{},infoShow:!1,rangeStu:!1,ORDER_INFO_QUERY_DAY:b["l"],queryParam:{},chargeBack:{title:"同意退款",form:null,visible:!1,status:"yes"},visible:!1,typeList:[{name:"已禁止退款",value:-1,color:"#e84a5f"},{name:"待审核",value:0,color:"#2db7f5"},{name:"通过",value:1,color:"#87d068"}],ORDER_INFO_STATUS:b["m"],pagination:{pageSize:10,current:1},columns:[{title:"订单号",dataIndex:"id",ellipsis:!0},{title:"会员信息",dataIndex:"userSnap",scopedSlots:{customRender:"userSnap"}},{title:"订单金额",dataIndex:"orderAmount",scopedSlots:{customRender:"orderAmount"}},{title:"退款金额",dataIndex:"refundAmount",scopedSlots:{customRender:"refundAmount"}},{title:"原始状态",dataIndex:"originStatus",scopedSlots:{customRender:"originStatus"}},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"订单备注",dataIndex:"content",scopedSlots:{customRender:"content"}},{title:"创建时间",scopedSlots:{customRender:"createdAt"},sorter:!0},{title:"操作",scopedSlots:{customRender:"action"}}],loadData:function(e){var a=e.pageNo,n=e.pageSize,r=e.sortOrder,o=void 0===r?"ascend":r,i=t.queryParam,s=i.status,c=i.geCreatedAt,u=i.leCreatedAt,l={page:a,limit:n,status:s,geCreatedAt:c||void 0,leCreatedAt:u||void 0,orders:{created_at:"ascend"===o?"desc":"asc"}};return Object(g["a"])(l).then((function(t){var e=t.data,r=e.list,o=e.totalCount;return{pageNo:a,pageSize:n,data:r,totalCount:o}}))},originText:"",originStatus:""}},created:function(){this.getQueryDay()},methods:{getQueryDay:function(){var t=this;_().then((function(e){var a=Object(o["cloneDeep"])(t.ORDER_INFO_QUERY_DAY),n=function(n){a.map((function(t){t.value===n&&(t.geCreatedAt=e.data[n]["start"],t.leCreatedAt=e.data[n]["end"]),"all"===t.value?t.isSelected=!0:t.isSelected=!1})),t.ORDER_INFO_QUERY_DAY=a};for(var r in e.data)n(r)}))},onChangeQueryDay:function(t,e){var a=this.ORDER_INFO_QUERY_DAY,n=this.queryParam;this.rangeStu=!1;var r=Object(o["cloneDeep"])(a);this.ORDER_INFO_QUERY_DAY=r.map((function(t,a){return t.isSelected=a===e,t})),n.geCreatedAt=t.geCreatedAt,n.leCreatedAt=t.leCreatedAt},onChangeTime:function(){this.rangeStu=!this.rangeStu,this.ORDER_INFO_QUERY_DAY.map((function(t){t.isSelected=!1}))},onChangeCreateTime:function(t,e){this.queryParam.geCreatedAt=e[0],this.queryParam.leCreatedAt=e[1]},onChangeForbid:function(t){var e=this;this.chargeBack={status:"no",title:"禁止退款",form:this.$form.createForm(this),visible:!0},this.originStatus=t.originStatus,this.ORDER_INFO_STATUS.map((function(a){a.value===t.originStatus&&(e.originText=a.name)})),new Promise((function(t){setTimeout(t,0)})).then((function(){e.chargeBack.form.setFieldsValue(Object(o["pick"])(t,["id","orderAmount"]))}))},getHandleForbid:function(){var t=this,e=this.$refs.table,a=this.$notification.success;this.chargeBack.form.validateFields((function(n,r){var o={id:r.id,failMsg:r.failMsg};if(!0===r.checkbox){var i={originStatus:t.originStatus};Object.assign(o,i)}n||Object(g["c"])(o).then((function(n){a({message:"成功",description:"已禁止退款"}),e.refresh(!0),t.chargeBack.visible=!1}))}))},onChangeApprove:function(t){var e=this;this.chargeBack={orderAmount:Number(t.orderAmount),status:"yes",title:"同意退款",form:this.$form.createForm(this),visible:!0},this.originStatus=t.originStatus,this.ORDER_INFO_STATUS.map((function(a){a.value===t.originStatus&&(e.originText=a.name)})),new Promise((function(t){setTimeout(t,0)})).then((function(){e.chargeBack.form.setFieldsValue(Object(o["pick"])(t,["id","orderAmount"]))}))},getHandleApprove:function(){var t=this,e=this.$refs.table,a=this.$notification.success;this.chargeBack.form.validateFields((function(n,r){var o={id:r.id,refundAmount:r.refundAmount,failMsg:r.failMsg||void 0};if(!0===r.checkbox){var i={originStatus:t.originStatus};Object.assign(o,i)}n||Object(g["b"])(o).then((function(n){a({message:"成功",description:"已同意退款"}),e.refresh(!0),t.chargeBack.visible=!1}))}))},getHandleInfo:function(t){var e=this,a=t.id;Object(S["f"])(a).then((function(t){var a=t.data;e.orderRow=a,e.infoShow=!0}))},cancelInfo:function(t){this.infoShow=t}}},x=y,A=(a("1bd7"),Object(d["a"])(x,n,r,!1,null,"dce770ba",null));e["default"]=A.exports}}]);