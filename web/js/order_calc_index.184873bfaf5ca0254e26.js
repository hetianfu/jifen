(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{"307":function(e,t,n){"use strict";n.d(t,"a",(function(){return asyncCalcOrder})),n.d(t,"l",(function(){return submitOrder})),n.d(t,"b",(function(){return asyncCalcScoresOrder})),n.d(t,"m",(function(){return submitScoresOrder})),n.d(t,"i",(function(){return goH5ToPay})),n.d(t,"j",(function(){return goToWalletPay})),n.d(t,"g",(function(){return getOrderPage})),n.d(t,"f",(function(){return getOrderInfo})),n.d(t,"h",(function(){return getQrCode})),n.d(t,"d",(function(){return confirmReceipt})),n.d(t,"c",(function(){return cancelOrderInfo})),n.d(t,"k",(function(){return refundOrder})),n.d(t,"e",(function(){return getConnectUser}));var o=n(9);function asyncCalcOrder(e){return o.a.post("/order-pays/calculate-order",e)}function submitOrder(e){return o.a.post("/order-pays/submit-order",e)}function asyncCalcScoresOrder(e){return o.a.post("/order-scores/calculate-order",e)}function submitScoresOrder(e){return o.a.post("/order-scores/submit-order",e)}function goH5ToPay(e){return o.a.get("/order-pays/h5-to-pay/"+e)}function goToWalletPay(e){return o.a.get("/order-pays/wallet-to-pay/"+e)}function getOrderPage(e){return o.a.get("/orders/get-page",{"params":e})}function getOrderInfo(e){return o.a.get("/orders/get-by-id/"+e)}function getQrCode(e){return o.a.get("/orders/get-qr-code/"+e)}function confirmReceipt(e){return o.a.put("/orders/receive-by-id",{"id":e})}function cancelOrderInfo(e){return o.a.put("/orders/cancel-by-id/"+e)}function refundOrder(e){return o.a.post("/orders/refund-by-id",e)}function getConnectUser(){return o.a.get("/orders/get-connect-user")}},"356":function(e,t,n){"use strict";n(25);var o=n(1),a=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var r=function(e){function Form(){_classCallCheck(this,Form);var e=_possibleConstructorReturn(this,(Form.__proto__||Object.getPrototypeOf(Form)).apply(this,arguments));return e.Forms=[],e.onSubmit=e.onSubmit.bind(e),e.onReset=e.onReset.bind(e),e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Form,e),a(Form,[{"key":"onSubmit","value":function onSubmit(e){e.preventDefault();for(var t=o.l.findDOMNode(this),n=[],a=t.getElementsByTagName("input"),r=0;r<a.length;r++)n.push(a[r]);var i={},c={};n.forEach((function(e){-1===e.className.indexOf("weui-switch")?"radio"!==e.type?"checkbox"!==e.type?i[e.name]=e.value:e.checked?c[e.name]?i[e.name].push(e.value):(c[e.name]=!0,i[e.name]=[e.value]):c[e.name]||(i[e.name]=[]):e.checked?(c[e.name]=!0,i[e.name]=e.value):c[e.name]||(i[e.name]=""):i[e.name]=e.checked}));for(var s=t.getElementsByTagName("textarea"),l=[],u=0;u<s.length;u++)l.push(s[u]);l.forEach((function(e){i[e.name]=e.value})),Object.defineProperty(e,"detail",{"enumerable":!0,"value":{"value":i}}),this.props.onSubmit(e)}},{"key":"onReset","value":function onReset(e){e.preventDefault(),this.props.onReset()}},{"key":"render","value":function render(){var e=this.props,t=e.className,n=e.style;return o.l.createElement("form",{"className":t,"style":n,"onSubmit":this.onSubmit,"onReset":this.onReset},this.props.children)}}]),Form}(o.l.Component);t.a=r},"512":function(e,t,n){},"513":function(e,t,n){e.exports={"order-timeout":"order-timeout_KV6je","order-timeout-body":"order-timeout-body_1IAS_","order-timeout-time":"order-timeout-time_1Nmo4"}},"622":function(e,t,n){"use strict";n.r(t);var o=n(21),a=n.n(o),r=n(1),i=n(126),c=n(2),s=n(40),l=n(356),u=n(441),p=n(364),d=n(8),m=n.n(d),f=(n(512),n(20)),y=n(307),h=n(10),b=n(305),v=n(17),O=n(319),g=n(513),w=n.n(g),C=n(14),S=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var E=function(e){function index(){_classCallCheck(this,index);var e=_possibleConstructorReturn(this,(index.__proto__||Object.getPrototypeOf(index)).apply(this,arguments));return e.state={"time":0},e.seconds=180,e.timeout=25,e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(index,e),S(index,[{"key":"componentDidMount","value":function componentDidMount(){this.setTimer()}},{"key":"componentWillUnmount","value":function componentWillUnmount(){this.clearTimer()}},{"key":"setTimer","value":function setTimer(){this.timer||this.countdown()}},{"key":"clearTimer","value":function clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=void 0)}},{"key":"countdown","value":function countdown(){var e=this,t=0,n=h.a.cloneDeep(this.timeout);this.timer=setInterval((function(){t>=1e3-n?(t=0,e.seconds--):t+=n;var o=Object(C.b)(e.seconds);o.millisecond=Math.floor(t/10),e.setState({"time":o},(function(){e.seconds<0&&(e.clearTimer(),e.props.onTimeUp&&e.props.onTimeUp())}))}),this.timeout)}},{"key":"formatNum","value":function formatNum(e){return e<10?"0"+e:""+e}},{"key":"onCallBack","value":function onCallBack(e){console.log(e),this.setState({"seconds":this.formatNum(e)})}},{"key":"onTimeUp","value":function onTimeUp(){console.log("时间到")}},{"key":"render","value":function render(){var e="order-timeout",t=this.state.time,n=this.props.className;return r.l.createElement(s.a,{"className":m()(w.a[e],n)},r.l.createElement(s.a,{"className":e+"-head"},"本品库存告急，请尽快支付"),r.l.createElement(s.a,{"className":e+"-body"},r.l.createElement(s.a,{"className":e+"-icon"}),r.l.createElement(s.a,{"className":m()(w.a[e+"-time"],"bnn-number")},this.formatNum(t.minutes),":",this.formatNum(t.seconds),":",this.formatNum(t.millisecond))))}}]),index}(c.a.Component),_=n(303),N=n(302);n.d(t,"default",(function(){return P}));var I=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),k=function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:get(a,t,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0};function calc_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function calc_possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var P=function(e){function Index(){calc_classCallCheck(this,Index);var e=calc_possibleConstructorReturn(this,(Index.__proto__||Object.getPrototypeOf(Index)).apply(this,arguments));return e.config={"backgroundTextStyle":"dark","navigationBarTextStyle":"black","navigationBarBackgroundColor":"#FFDD00"},e.state={"params":{},"type":0,"typeList":[{"title":"快递配送","value":0},{"title":"","value":1}],"loading":!0,"isScore":!1,"payType":b.g.ALIPAY,"payList":[],"orderInfo":{},"showShop":!1,"isReserve":Number(Object(v.f)("reserveStatus")),"showCoupon":!1,"showAddress":!1,"showReserve":!1,"showWallet":!1,"userInfo":{},"shopInfo":{},"couponInfo":{},"addressInfo":{},"connectSnap":{},"appointTime":"","shopList":[],"couponList":[],"productList":[],"addressList":[],"showSelectCity":!1},e}var t;return function calc_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Index,e),I(Index,[{"key":"componentDidMount","value":function componentDidMount(){var e=this;this.setState({"params":Object(C.k)(this)},(function(){e.initOrder()}))}},{"key":"onInputAddress","value":function onInputAddress(e,t){var n=t.detail.value,o=this.state.addressInfo;o[e]=n,this.setState({"addressInfo":o})}},{"key":"initOrder","value":(t=function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function step(o,a){try{var r=t[o](a),i=r.value}catch(e){return void n(e)}if(!r.done)return Promise.resolve(i).then((function(e){step("next",e)}),(function(e){step("throw",e)}));e(i)}("next")}))}}(a.a.mark((function _callee(){var e,t=this;return a.a.wrap((function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(y.e)().then((function(e){return e.data||{}}));case 2:e=n.sent,this.initPayType(),this.setState({"addressInfo":e},(function(){t.calcOrder()}));case 5:case"end":return n.stop()}}),_callee,this)}))),function initOrder(){return t.apply(this,arguments)})},{"key":"initPayType","value":function initPayType(){var e=Object(v.d)(),t=e.openAliPay,n=[];0!=e.openWeChatPay&&n.push({"name":"微信支付","desc":"微信便捷支付","value":b.g.WECHAT}),0!=t&&n.push({"name":"支付宝支付","desc":"支付宝便捷支付","value":b.g.ALIPAY});var o=h.a.head(n).value;this.setState({"payType":o,"payList":n})}},{"key":"calcOrder","value":function calcOrder(){var e=this,t=this.state,n=t.params,o=t.loading,a=t.addressInfo,r=t.couponInfo,c=t.orderInfo,s=t.isScore,l=t.type,u=t.typeList,p={"id":c.id,"distribute":u[l].value,"productList":n.cartList,"userCouponId":r.id,"couponDiscount":r.amount,"scoreDiscount":s?c.deductScoreAmount:void 0};n.fullPay&&(p.fullPay=n.fullPay),a&&(p.cityCode=a.cityCode),o||Object(i.b)({"title":"请稍后","mask":!0}),Object(y.a)(p).then((function(t){var n=t.data;e.setState({"orderInfo":n,"couponList":n.couponList||[],"productList":n.productList},(function(){Object(i.a)(),e.setState({"loading":!1})}))}))}},{"key":"onSwitchType","value":function onSwitchType(e){}},{"key":"onSwitchPayType","value":function onSwitchPayType(e){this.setState({"payType":e})}},{"key":"openScore","value":function openScore(e){var t=this;this.setState({"isScore":!e},(function(){t.calcOrder()}))}},{"key":"onConfirmSelect","value":function onConfirmSelect(e,t){var n=this,o=this.state.couponInfo;"couponInfo"===e&&(t=o.id===t.id?{}:t),this.setState(function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{"value":n,"enumerable":!0,"configurable":!0,"writable":!0}):e[t]=n,e}({},e,t),(function(){("couponInfo"===e&&o.id!==t.id||"addressInfo"===e)&&n.calcOrder()}))}},{"key":"showCityPopup","value":function showCityPopup(e){this.setState({"showSelectCity":e})}},{"key":"onConfirmCity","value":function onConfirmCity(e,t){var n=this.state.addressInfo;Object.assign(n,{"cityCode":e,"city":t}),this.setState({"addressInfo":n})}},{"key":"onSubmit","value":function onSubmit(e){var t=this,n=e.detail.value,o=(this.$router.params,this.state),a=(o.type,o.payType),r=o.orderInfo,c=(o.addressInfo,o.shopInfo,o.couponInfo),s=(o.appointTime,{"id":r.id,"payType":a,"userCouponId":c.id,"couponDiscount":c.amount});Object.keys(n).map((function(e){h.a.set(s,e,n[e])})),s.addressSnap.name?s.addressSnap.telephone?s.addressSnap.city?s.addressSnap.detail?(s.connectSnap=s.addressSnap,Object(i.b)({"title":"请稍后","mask":!0}),Object(y.l)(s).then((function(e){a===b.g.WECHAT?t.createMiniWechatAppPay(e.data):t.createMiniAliAppPay(e.data)}))):Object(i.d)({"title":"请输入详细地址","icon":"none"}):Object(i.d)({"title":"请选择所在地区","icon":"none"}):Object(i.d)({"title":"请输入联系电话","icon":"none"}):Object(i.d)({"title":"请输入联系人","icon":"none"})}},{"key":"onCancelWalletPay","value":function onCancelWalletPay(){var e=this.state.orderInfo;Object(N.w)(e.id,!0)}},{"key":"onConfirmWalletPay","value":function onConfirmWalletPay(){var e=this.state.orderInfo;Object(i.b)({"title":"请稍后","mask":!0}),Object(y.j)(e.id).then((function(){Object(i.a)(),Object(i.d)({"title":"扣款成功","icon":"success"}),Object(N.v)(!0)}))}},{"key":"createMiniWechatAppPay","value":function createMiniWechatAppPay(e){Object(y.i)(e).then((function(e){var t=e.data;Object(i.a)(),window.location.replace(t)}))}},{"key":"createMiniAliAppPay","value":function createMiniAliAppPay(e){Object(i.a)(),window.location.replace(f.k+"/ali-pays/h5-to-pay/"+e)}},{"key":"render","value":function render(){var e=this,t=this.state,n=t.loading,o=t.type,a=t.typeList,i=t.payType,c=t.addressInfo,d=t.userInfo,f=(t.shopInfo,t.isReserve,t.couponInfo),y=(t.connectSnap,t.couponList),h=(t.addressList,t.productList),v=(t.shopList,t.showCoupon),g=(t.showShop,t.showAddress,t.showReserve,t.showWallet,t.orderInfo),w=(t.appointTime,t.isScore,t.payList),C=t.showSelectCity,S=!function isSubmit(e){var t=e.payType,n=e.userInfo,o=e.orderInfo;return b.g.WALLET!==t||n.amount>=o.payAmount}({"payType":i,"userInfo":d,"orderInfo":g});return r.l.createElement(s.a,{"id":"calc-order-page","className":"index calc-order-page"},n&&r.l.createElement(_.E,{"isCover":!0}),r.l.createElement(l.a,{"className":"index-scroll","onSubmit":this.onSubmit.bind(this)},r.l.createElement(E,{"seconds":180,"className":"order-timeout"}),r.l.createElement(s.a,{"className":"index-head delivery-type"},r.l.createElement(s.a,{"className":"type-list d-f a-i-f-e"},a.map((function(t,n){return r.l.createElement(s.a,{"key":n,"className":m()("type-item d-f a-i-c j-c-c",{"active":o===n}),"onClick":e.onSwitchType.bind(e,n)},t.title)}))),r.l.createElement(s.a,{"className":"card-list address-icon"},r.l.createElement(s.a,{"className":"list-item thin-border__b"},r.l.createElement(s.a,{"className":"item-left"},"联系人"),r.l.createElement(s.a,{"className":"item-right"},r.l.createElement(u.a,{"name":"addressSnap.name","value":c.name,"maxLength":16,"placeholder":"请输入联系姓名","className":"item-input","onInput":this.onInputAddress.bind(this,"name")}))),r.l.createElement(s.a,{"className":"list-item thin-border__b"},r.l.createElement(s.a,{"className":"item-left"},"联系电话"),r.l.createElement(s.a,{"className":"item-right"},r.l.createElement(u.a,{"name":"addressSnap.telephone","type":"number","value":c.telephone,"maxLength":11,"placeholder":"请输入联系电话","className":"item-input","onInput":this.onInputAddress.bind(this,"telephone")}))),r.l.createElement(s.a,{"className":"list-item thin-border__b"},r.l.createElement(s.a,{"className":"item-left"},"所在地区"),r.l.createElement(s.a,{"className":"item-right"},r.l.createElement(u.a,{"name":"addressSnap.city","value":c.city,"disabled":!0,"placeholder":"请选择所在地区","className":"item-input","onClick":this.showCityPopup.bind(this,!0)}),r.l.createElement(u.a,{"name":"addressSnap.cityCode","value":c.cityCode,"className":"item-input display-none"}))),r.l.createElement(s.a,{"className":"list-item thin-border__b"},r.l.createElement(s.a,{"className":"item-left"},"详细地址"),r.l.createElement(s.a,{"className":"item-right"},r.l.createElement(u.a,{"name":"addressSnap.detail","value":c.detail,"placeholder":"请输入详细地址","className":"item-input","onInput":this.onInputAddress.bind(this,"detail")}))),r.l.createElement(s.a,{"className":"list-item f-w-w"},r.l.createElement(s.a,{"className":"item-left"},"备注信息"),r.l.createElement(s.a,{"className":"item-right"},r.l.createElement(u.a,{"name":"remark","maxLength":255,"placeholder":"备注（150字以内）","className":"item-input"}))))),r.l.createElement(s.a,{"className":"order-card cart-list"},h.map((function(e,t){return r.l.createElement(O.a,{"key":e.id,"info":e,"className":m()("cart-item",{"thin-border__b":t<h.length-1})})}))),r.l.createElement(s.a,null,r.l.createElement(s.a,{"className":"order-card pay-type"},r.l.createElement(s.a,{"className":"pay-title d-f a-i-c"},"支付方式"),r.l.createElement(s.a,{"className":"type-list"},w.map((function(t){return r.l.createElement(s.a,{"className":m()("type-item",i===t.value&&"active"),"onClick":e.onSwitchPayType.bind(e,t.value)},r.l.createElement(s.a,{"className":"type-left f-g-5 thin-border__r"},t.value===b.g.ALIPAY?r.l.createElement(s.a,{"className":"type-icon alipay-icon bnn-icon"},""):r.l.createElement(s.a,{"className":"type-icon wechat-icon bnn-icon"},""),r.l.createElement(s.a,{"className":"type-title"},t.name)),r.l.createElement(s.a,{"className":"type-right f-g-5"},t.desc))})))),r.l.createElement(s.a,{"className":"index-foot--height"}),r.l.createElement(s.a,{"className":"index-foot d-f a-i-c fy-popup fy-popup--bottom"},r.l.createElement(s.a,{"className":"total-num"},"共",h.length,"件"),r.l.createElement(s.a,{"className":"total-money d-f a-i-b j-c-e"},"合计：",r.l.createElement(_.G,{"price":g.needScore,"priceSize":44,"className":"m-r-10"}),r.l.createElement(_.L,{"price":g.payAmount,"priceSize":32})),r.l.createElement(p.a,{"disabled":S,"formType":"submit","className":"buy-now d-f a-i-c j-c-c","hoverClass":"hover-class--btn"},"提交订单"))),r.l.createElement(s.a,{"className":"pay-tips--height"}),r.l.createElement(s.a,{"className":"pay-tips f-g-5"},r.l.createElement(s.a,{"className":"pay-tips-icon bnn-icon"},""),r.l.createElement(s.a,{"className":"pay-tips-text"},"您正在安全购物环境中，请放心购买"))),r.l.createElement(_.h,{"isOpened":v,"item":f,"list":y,"onClose":this.setState.bind(this,{"showCoupon":!1}),"onConfirm":this.onConfirmSelect.bind(this,"couponInfo")}),r.l.createElement(_.M,{"isOpened":C,"cityCode":c.cityCode,"onConfirm":this.onConfirmCity.bind(this),"onClose":this.showCityPopup.bind(this,!1)}))}},{"key":"componentDidShow","value":function componentDidShow(){k(Index.prototype.__proto__||Object.getPrototypeOf(Index.prototype),"componentDidShow",this)&&k(Index.prototype.__proto__||Object.getPrototypeOf(Index.prototype),"componentDidShow",this).call(this)}},{"key":"componentDidHide","value":function componentDidHide(){k(Index.prototype.__proto__||Object.getPrototypeOf(Index.prototype),"componentDidHide",this)&&k(Index.prototype.__proto__||Object.getPrototypeOf(Index.prototype),"componentDidHide",this).call(this)}}]),Index}(c.a.Component)}}]);